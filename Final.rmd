---
title: "Covid91 vaccine study Final2023"
author: "Estrella Aguilar "
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---



```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
OldData <-read.csv(file="final.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- OldData %>% mutate(infected = recode(infected, covid19 = "covid", OK = "OK" )) %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
Males = filter(FinalData, sex =="M")
Females = filter(FinalData, sex =="F")
LGBTQ = filter(FinalData, LGBTQ =="gay")
Druggies = filter(FinalData, DrugUser =="yes")
```





# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

# Code block modification 

I made some changes to the block of code on line 14, I used Tay's example as an example for what changes to make. I separated each variable into its own line and changed its name to Males, Females, LGBTQ and DrugUser(because druggies was not found). I also changed some formatting to seperate the people who got covid and the people who did not get covid. This allowed for all 4 groups to pop up in the environment panel. 

## Males


## Barplot 

```{r}
dd2 <- Males %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```


This plot shows the amount of males who got Covid after getting the vaccine and taking a placebo. 
  
### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=Males)
rowPerc(table1)
colPerc(table1)
```
The plot and numerical resulsts shows that 69% got covid after taking the placebo and only 30% got covid after getting the vaccine. A significantly larger percentage of those who took the placebo  contracted covid-19 than those who got the vaccine. The vaccine appears to provide more protection against Covid-19.

### Inferential 

```{r}
chisq.test(table1)
chisqtestGC(table1)
Malesfish <- fisher.test(table1)
Malesfish
```


These are the  results of the output of the Fisher's Exact test. The p-value is 1.098e-13. The null hypothesis predicted that the deaths related to covid-19 are independent of sex. Since it is clear that sex does play a role in the death rate of individuals, the alternative hypothesis, that there is a correlation between covid-19 deaths and sex, is the favorable option.The odd ratio above illustrates a ratio of 2.242422. 


```{r}
effect <- Malesfish$p.value/(Malesfish$p.value +1)
effectivenessMales = Malesfish$estimate/(Malesfish$estimate +1)*100
print(effectivenessMales)
```
```{r}
low=(Malesfish$conf.int[1]/(Malesfish$conf.int[1] +1))*100
hi=(Malesfish$conf.int[2]/(Malesfish$conf.int[2] +1))*100
options(digits=2)
```

Above is the effectiveness for the covid-19 vaccine for guys(males). If the effectiveness is above 50% that means that the vaccine is effective. Based on the interval seen above, we cn conclude that the vaccine is effective in protecting Males from getting covid-19.The odds ratio is approximately how effective the vaccine is. The odds ratio for the Males is 69.15981%

## Females
```{r}
dd2 <- Females %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```
This plot shows the amount of Females who got Covid after getting the vaccine and taking a placebo. 

### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=Females)
rowPerc(table1)
colPerc(table1)
```

The plot and numerical resulsts shows that 60% got covid after taking the placebo and only 40% got covid after getting the vaccine. A significantly larger percentage of those who took the placebo  contracted covid-19 than those who got the vaccine. The vaccine appears to provide more protection against Covid-19.

### Inferential 

```{r}
chisq.test(table1)
chisqtestGC(table1)
Femalesfish <- fisher.test(table1)
Femalesfish
```

These are the  results of the output of the Fisher's Exact test. The p-value is 3e-04. The null hypothesis predicted that the deaths related to covid-19 are independent of sex. Since it is clear that sex does play a role in the death rate of individuals, the alternative hypothesis, that there is a correlation between covid-19 deaths and sex, is the favorable option.The odd ratio above illustrates a ratio of 1.5. 

```{r}
effect <- Femalesfish$p.value/(Femalesfish$p.value +1)
effectivenessFemales = Femalesfish$estimate/(Femalesfish$estimate +1)*100
print(effectivenessFemales)
```
```{r}
low=(Femalesfish$conf.int[1]/(Femalesfish$conf.int[1] +1))*100
hi=(Femalesfish$conf.int[2]/(Femalesfish$conf.int[2] +1))*100
options(digits=2)
```

Above is the effectiveness for the covid-19 vaccine for Females. If the effectiveness is above 50% that means that the vaccine is effective. Based on the interval seen above, we cn conclude that the vaccine is effective in protecting Femaales from getting covid-19.The odds ratio is approximately how effective the vaccine is. The odds ratio for the Females is 60%.

## LGBTQ

```{r}
dd2 <- LGBTQ %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```
This plot shows the amount of LGBTQ people who got Covid after getting the vaccine and taking a placebo. 

### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=LGBTQ)
rowPerc(table1)
colPerc(table1)
```
The plot and numerical results shows that 15% got covid after taking the placebo and only 85% got covid after getting the vaccine. A significantly larger percentage of those who got the vaccine  contracted covid-19 than those who took the placebo. The vaccine appears to provide no protection against Covid-19.

### Inferential 

```{r}
chisq.test(table1)
chisqtestGC(table1)
LGBTQfish <- fisher.test(table1)
LGBTQfish
```

These are the  results of the output of the Fisher's Exact test. The p-value is 7e-08. The odd ratio above illustrates a ratio of 0.18. 

```{r}
effect <- LGBTQfish$p.value/(LGBTQfish$p.value +1)
effectivenessLGBTQ = LGBTQfish$estimate/(LGBTQfish$estimate +1)*100
print(effectivenessLGBTQ)
```
```{r}
low=(LGBTQfish$conf.int[1]/(LGBTQfish$conf.int[1] +1))*100
hi=(LGBTQfish$conf.int[2]/(LGBTQfish$conf.int[2] +1))*100
options(digits=2)
```

Above is the effectiveness for the covid-19 vaccine for LGBTQ. If the effectiveness is above 50% that means that the vaccine is effective. Based on the interval seen above, we cn conclude that the vaccine is not effective in protecting LGBTQ from getting covid-19.The odds ratio is approximately how effective the vaccine is. The odds ratio for the LGBTQ is 15%.

## Druggies
```{r}
dd2 <- Druggies %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot shows the amount of Druggies who got Covid after getting the vaccine and taking a placebo. 

### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=Druggies)
rowPerc(table1)
colPerc(table1)
```
The plot and numerical results shows that 12% got covid after taking the placebo and only 88% got covid after getting the vaccine. A significantly larger percentage of those who got the vaccine  contracted covid-19 than those who took the placebo. The vaccine appears to provide no protection against Covid-19.

### Inferential 

```{r}
chisq.test(table1)
chisqtestGC(table1)
Druggiesfish <- fisher.test(table1)
Druggiesfish
```

These are the  results of the output of the Fisher's Exact test. The p-value is 3e-09. The odd ratio above illustrates a ratio of 0.13. 

```{r}
effect <- Druggiesfish$p.value/(Druggiesfish$p.value +1)
effectivenessDruggies = Druggiesfish$estimate/(Druggiesfish$estimate +1)*100
print(effectivenessDruggies)
```
```{r}
low=(Druggiesfish$conf.int[1]/(Druggiesfish$conf.int[1] +1))*100
hi=(Druggiesfish$conf.int[2]/(Druggiesfish$conf.int[2] +1))*100
options(digits=2)
```

  
Above is the effectiveness for the covid-19 vaccine for Druggies. If the effectiveness is above 50% that means that the vaccine is effective. Based on the interval seen above, we can conclude that the vaccine is not effective in protecting Druggies from getting covid-19.The odds ratio is approximately how effective the vaccine is. The odds ratio for the Druggies is 11%.


# Overall Results and Conclusions

The covid-19 vaccine was not effective for both people who are LGBTQ and Druggies, they both got an effectiveness percentage under 50% which means that the vaccien was not effective.However, the covid-19 vaccine was effective for both Males and Females they both got an effectiveness score over 50%. 